<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TT AutoPlayer</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        #player-wrapper { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        .btn-start { position: absolute; z-index: 99; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; cursor: pointer; border: none; color: white; font-size: 20px; }
        .hidden { display: none !important; }
        .timer-line { height: 4px; background: #ff0050; width: 100%; transition: width linear; }
    </style>
</head>
<body>

    <button class="btn-start" id="startBtn">НАЖМИ ДЛЯ ЗАПУСКА ПЛЕЕРА</button>
    
    <div id="player-wrapper">
        <div id="container"></div>
    </div>
    <div class="timer-line" id="progress"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const playlist = [
            { id: "7601947636333169942", time: 5000 },
            { id: "7601966443319577859", time: 3000 }
        ];

        let index = 0;

        document.getElementById('startBtn').onclick = function() {
            this.classList.add('hidden');
            loadVideo();
        };

        function loadVideo() {
            const container = document.getElementById('container');
            const progress = document.getElementById('progress');
            const video = playlist[index];

            // Формируем чистый эмбед с параметром автоплея
            container.innerHTML = `
                <blockquote class="tiktok-embed" 
                    cite="https://www.tiktok.com/video/${video.id}" 
                    data-video-id="${video.id}" 
                    style="width: 100%; height: 100%;">
                    <section></section>
                </blockquote>
            `;

            // Сброс и запуск полоски прогресса
            progress.style.transition = 'none';
            progress.style.width = '100%';
            setTimeout(() => {
                progress.style.transition = `width ${video.time}ms linear`;
                progress.style.width = '0%';
            }, 10);

            // Перезагрузка скрипта TikTok
            const oldTag = document.getElementById('tt-script');
            if (oldTag) oldTag.remove();
            const script = document.createElement('script');
            script.id = 'tt-script';
            script.src = "https://www.tiktok.com/embed.js";
            document.body.appendChild(script);

            // Таймер перехода
            setTimeout(() => {
                index = (index + 1) % playlist.length;
                loadVideo();
            }, video.time);
        }
    </script>
</body>
</html>
